[unix_http_server]
file=/tmp/supervisor.sock

[inet_http_server]
port=*:9001
;username=super
;password=super

[supervisord]
logfile=<%= node["webscreenshots"]["supervisord"]["logdir"] %>/supervisord.log
pidfile=<%= node["webscreenshots"]["supervisord"]["pidfile"] %>
nodaemon=true

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[program:redis]
command=/usr/local/bin/redis-server
stdout_logfile=<%= node["webscreenshots"]["supervisord"]["logdir"] %>/redis.log
redirect_stderr=true
priority=1

[program:celeryd]
command=<%= node["webscreenshots"]["home"] %>/bin/celery worker -B -E -A webscreenshots.celeryapp -l info
stdout_logfile=<%= node["webscreenshots"]["supervisord"]["logdir"] %>/celeryd.log
redirect_stderr=true
startsecs=10
stopwaitsecs=300
stopsignal=KILL
killasgroup=true
priority=2

[program:django]
directory=<%= node["webscreenshots"]["working_dir"] %>
command=<%= node["webscreenshots"]["home"] %>/bin/python manage.py run_gunicorn 127.0.0.1:9011
stdout_logfile=<%= node["webscreenshots"]["supervisord"]["logdir"] %>/django.log
redirect_stderr=true
priority=3

[program:flower]
command=<%= node["webscreenshots"]["home"] %>/bin/celery flower --broker=redis://localhost:6379/0
stdout_logfile=<%= node["webscreenshots"]["supervisord"]["logdir"] %>/flower.log
redirect_stderr=true
startsecs=10
stopwaitsecs=30
stopsignal=TERM
priority=4
